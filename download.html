<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Downloaded Files</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* File type icon colors */
        .file-icon-pdf {
            color: #ef4444;
        }

        .file-icon-doc {
            color: #3b82f6;
        }

        .file-icon-img {
            color: #10b981;
        }

        .file-icon-video {
            color: #8b5cf6;
        }

        .file-icon-audio {
            color: #f59e0b;
        }

        .file-icon-zip {
            color: #6366f1;
        }

        .file-icon-code {
            color: #ec4899;
        }

        .file-icon-default {
            color: #6b7280;
        }

        /* Loading animation */
        .loader {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Truncated filename styling */
        .truncated-filename {
            max-width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Tooltip for full filename */
        .filename-tooltip {
            position: relative;
            cursor: help;
        }

        .filename-tooltip:hover::after {
            content: attr(data-fullname);
            position: absolute;
            left: 0;
            top: 100%;
            background-color: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-top: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8 px-4">

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto">

        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">
                <i class="fas fa-download text-blue-600"></i> Downloaded Files
            </h1>
            <p class="text-gray-600">View and manage all uploaded files</p>
        </div>

        <!-- Action Bar -->
        <div class="bg-white rounded-t-2xl shadow-xl p-4">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center">
                    <i id="fileIcon" class="fas cursor-pointer fa-file text-blue-600 mr-2"></i>
                    <span class="font-semibold text-gray-700">Total Files: <span id="totalFiles">0</span></span>
                    <span class="mx-2 text-gray-400">|</span>
                    <span class="font-semibold text-gray-700">Showing: <span id="showingFiles">0</span></span>
                </div>
                <div class="flex gap-2 w-full md:w-auto">
                    <div class="relative flex-1 md:flex-initial">
                        <input type="text" id="searchInput" placeholder="Search files..."
                            class="w-full md:w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <button id="deleteAllBtn"
                        class="hidden bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 whitespace-nowrap">
                        <i class="fas fa-trash-alt md:mr-2"></i>
                        <span class="hidden md:inline">Delete All</span>
                    </button>
                    <button id="refreshBtn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 whitespace-nowrap">
                        <i class="fas fa-sync-alt md:mr-2"></i>
                        <span class="hidden md:inline">Refresh</span>
                    </button>
                    <a href="index.html"
                        class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 whitespace-nowrap">
                        <i class="fas fa-upload md:mr-2"></i>
                        <span class="hidden md:inline">Upload Files</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Files Table -->
        <div class="bg-white rounded-b-2xl shadow-xl overflow-hidden">

            <!-- Loading State -->
            <div id="loadingState" class="flex flex-col items-center justify-center py-16">
                <div class="loader mb-4"></div>
                <p class="text-gray-600">Loading files...</p>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="hidden flex-col items-center justify-center py-16">
                <i class="fas fa-folder-open text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">No Files Found</h3>
                <p class="text-gray-500 mb-4">Upload some files to get started</p>
                <a href="index.html"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition duration-300">
                    <i class="fas fa-upload mr-2"></i> Upload Files
                </a>
            </div>

            <!-- Table Container -->
            <div id="tableContainer" class="hidden overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 border-b-2 border-gray-200">
                        <tr>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">
                                File Name
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">
                                Size
                            </th>
                            <th
                                class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">
                                Upload Date
                            </th>
                            <th
                                class="px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody id="fileTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Files will be appended here dynamically -->
                    </tbody>
                </table>
            </div>

        </div>

    </div>

    <script>
        // Check if delete mode is enabled via URL parameter (define globally)
        const urlParams = new URLSearchParams(window.location.search);
        const deleteMode = urlParams.get('delete') === 'true';

        $(document).ready(function () {

            // Get DOM elements
            const $loadingState = $('#loadingState');
            const $emptyState = $('#emptyState');
            const $tableContainer = $('#tableContainer');
            const $fileTableBody = $('#fileTableBody');
            const $totalFiles = $('#totalFiles');
            const $showingFiles = $('#showingFiles');
            const $refreshBtn = $('#refreshBtn');
            const $searchInput = $('#searchInput');
            const $deleteAllBtn = $('#deleteAllBtn');

            // Store all files
            let allFiles = [];
            let filteredFiles = [];

            // Debug: Log delete mode status
            console.log('Delete mode:', deleteMode);
            console.log('URL params:', window.location.search);

            // Show delete all button if delete mode is enabled
            if (deleteMode) {
                $deleteAllBtn.removeClass('hidden');
                console.log('Delete All button should be visible now');
            }

            // Load files on page load
            loadFiles();

            // Refresh button click
            $refreshBtn.on('click', function () {
                // Disable button and show loading
                const $btn = $(this);
                const originalHtml = $btn.html();
                $btn.prop('disabled', true).addClass('opacity-50 cursor-not-allowed');
                $btn.html('<i class="fas fa-spinner fa-spin md:mr-2"></i> <span class="hidden md:inline">Loading...</span>');

                // Load files
                loadFiles();

                // Re-enable button after a short delay (will be re-enabled in loadFiles anyway)
                setTimeout(function () {
                    $btn.prop('disabled', false).removeClass('opacity-50 cursor-not-allowed');
                    $btn.html(originalHtml);
                }, 1000);
            });

            // Search input - filter files in real-time
            $searchInput.on('input', function () {
                const searchTerm = $(this).val().toLowerCase().trim();

                if (searchTerm === '') {
                    // Show all files if search is empty
                    filteredFiles = allFiles;
                } else {
                    // Filter files by name
                    filteredFiles = allFiles.filter(function (file) {
                        return file.name.toLowerCase().includes(searchTerm);
                    });
                }

                // Display filtered files
                if (filteredFiles.length === 0) {
                    // Show empty state
                    $tableContainer.hide();
                    $emptyState.removeClass('hidden').addClass('flex');
                    $emptyState.find('h3').text('No Files Found');
                    $emptyState.find('p').text('Try adjusting your search term');
                    $showingFiles.text('0');
                } else {
                    // Show filtered files
                    $emptyState.hide();
                    $tableContainer.show();
                    displayFiles(filteredFiles);
                    $showingFiles.text(filteredFiles.length);
                }
            });

            // Delete all files button
            $deleteAllBtn.on('click', function () {
                // Show confirmation dialog using SweetAlert2
                Swal.fire({
                    title: 'Delete All Files?',
                    text: 'This will permanently delete all files in the upload directory. This action cannot be undone!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#dc2626',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: 'Yes, delete all!',
                    cancelButtonText: 'Cancel',
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Disable button and show loading
                        const originalHtml = $deleteAllBtn.html();
                        $deleteAllBtn.prop('disabled', true).addClass('opacity-50 cursor-not-allowed');
                        $deleteAllBtn.html('<i class="fas fa-spinner fa-spin md:mr-2"></i> <span class="hidden md:inline">Deleting...</span>');

                        // User confirmed, delete all files
                        deleteAllFiles();
                    }
                });
            });

            // Function to load files from server
            function loadFiles() {
                // Show loading state
                $loadingState.show();
                $emptyState.hide();
                $tableContainer.hide();

                // Disable refresh button
                $refreshBtn.prop('disabled', true).addClass('opacity-50');

                // AJAX request to get files
                $.ajax({
                    url: 'get_files.php',
                    type: 'GET',
                    dataType: 'json',
                    success: function (response) {
                        // Enable refresh button
                        $refreshBtn.prop('disabled', false).removeClass('opacity-50');

                        if (response.success) {
                            if (response.files.length === 0) {
                                // Show empty state
                                $loadingState.hide();
                                $emptyState.removeClass('hidden').addClass('flex');
                                $totalFiles.text('0');
                                $showingFiles.text('0');
                            } else {
                                // Store all files
                                allFiles = response.files;
                                filteredFiles = response.files;

                                // Show table with files
                                $loadingState.hide();
                                $tableContainer.removeClass('hidden').show();
                                displayFiles(response.files);
                                $totalFiles.text(response.files.length);
                                $showingFiles.text(response.files.length);
                            }
                        } else {
                            // Show error
                            $loadingState.hide();
                            $emptyState.removeClass('hidden').addClass('flex');
                            $emptyState.find('h3').text('Error Loading Files');
                            $emptyState.find('p').text(response.message);
                        }
                    },
                    error: function () {
                        // Enable refresh button
                        $refreshBtn.prop('disabled', false).removeClass('opacity-50');

                        // Show error state
                        $loadingState.hide();
                        $emptyState.removeClass('hidden').addClass('flex');
                        $emptyState.find('h3').text('Error Loading Files');
                        $emptyState.find('p').text('Failed to connect to server');
                    }
                });
            }

            // Function to display files in table
            function displayFiles(files) {
                // Clear existing table
                $fileTableBody.empty();

                // Add each file to table
                files.forEach(function (file) {
                    const fileRow = createFileRow(file);
                    $fileTableBody.append(fileRow);
                });
            }

            // Function to create file row HTML
            function createFileRow(file) {
                const fileIcon = getFileIcon(file.name);
                const fileIconClass = getFileIconClass(file.name);
                const fileSize = formatFileSize(file.size);
                const uploadDate = formatDate(file.modified);
                const displayName = truncateFilename(file.name, 40);

                // Add delete button if delete mode is enabled
                let deleteButton = '';
                if (deleteMode) {
                    deleteButton = `
                        <button class="delete-file bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 text-sm" data-filename="${file.name}">
                            <i class="fas fa-trash-alt md:mr-1"></i> 
                            <span class="hidden md:inline">Delete</span>
                        </button>
                    `;
                }

                return `
                    <tr class="transition duration-200" data-filename="${file.name}">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <i class="fas ${fileIcon} text-2xl ${fileIconClass} mr-4"></i>
                                <div class="text-sm">
                                    <div class="font-semibold text-gray-800 filename-tooltip" data-fullname="${file.name}" title="${file.name}">
                                        ${displayName}
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="text-sm text-gray-700">${fileSize}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="text-sm text-gray-700">${uploadDate}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <div class="flex justify-center gap-2 flex-wrap">
                                <a href="${file.url}" download class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 text-sm">
                                    <i class="fas fa-download md:mr-1"></i> 
                                    <span class="hidden md:inline">Download</span>
                                </a>
                                <button class="copy-link bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 text-sm" data-url="${file.url}">
                                    <i class="fas fa-copy md:mr-1"></i> 
                                    <span class="hidden md:inline">Copy</span>
                                </button>
                                ${deleteButton}
                            </div>
                        </td>
                    </tr>
                `;
            }

            // Function to truncate filename
            function truncateFilename(filename, maxLength) {
                // If filename is shorter than max length, return as is
                if (filename.length <= maxLength) {
                    return filename;
                }

                // Get file extension
                const lastDotIndex = filename.lastIndexOf('.');

                if (lastDotIndex === -1) {
                    // No extension, just truncate
                    return filename.substring(0, maxLength - 3) + '...';
                }

                const extension = filename.substring(lastDotIndex);
                const nameWithoutExt = filename.substring(0, lastDotIndex);

                // Calculate how many characters we can keep from the name
                const availableLength = maxLength - extension.length - 3; // 3 for '...'

                if (availableLength <= 0) {
                    // Extension is too long, just show extension
                    return '...' + extension;
                }

                // Truncate name and add extension
                return nameWithoutExt.substring(0, availableLength) + '...' + extension;
            }

            // Function to get file icon based on extension
            function getFileIcon(fileName) {
                const ext = fileName.split('.').pop().toLowerCase();

                const iconMap = {
                    // Documents
                    'pdf': 'fa-file-pdf',
                    'doc': 'fa-file-word',
                    'docx': 'fa-file-word',
                    'txt': 'fa-file-alt',
                    'rtf': 'fa-file-alt',
                    'odt': 'fa-file-word',

                    // Spreadsheets
                    'xls': 'fa-file-excel',
                    'xlsx': 'fa-file-excel',
                    'csv': 'fa-file-csv',

                    // Presentations
                    'ppt': 'fa-file-powerpoint',
                    'pptx': 'fa-file-powerpoint',

                    // Images
                    'jpg': 'fa-file-image',
                    'jpeg': 'fa-file-image',
                    'png': 'fa-file-image',
                    'gif': 'fa-file-image',
                    'bmp': 'fa-file-image',
                    'svg': 'fa-file-image',
                    'webp': 'fa-file-image',

                    // Videos
                    'mp4': 'fa-file-video',
                    'avi': 'fa-file-video',
                    'mov': 'fa-file-video',
                    'wmv': 'fa-file-video',
                    'mkv': 'fa-file-video',
                    'webm': 'fa-file-video',

                    // Audio
                    'mp3': 'fa-file-audio',
                    'wav': 'fa-file-audio',
                    'ogg': 'fa-file-audio',
                    'flac': 'fa-file-audio',
                    'm4a': 'fa-file-audio',

                    // Archives
                    'zip': 'fa-file-archive',
                    'rar': 'fa-file-archive',
                    '7z': 'fa-file-archive',
                    'tar': 'fa-file-archive',
                    'gz': 'fa-file-archive',

                    // Code
                    'html': 'fa-file-code',
                    'css': 'fa-file-code',
                    'js': 'fa-file-code',
                    'php': 'fa-file-code',
                    'py': 'fa-file-code',
                    'java': 'fa-file-code',
                    'cpp': 'fa-file-code',
                    'c': 'fa-file-code',
                    'json': 'fa-file-code',
                    'xml': 'fa-file-code',
                };

                return iconMap[ext] || 'fa-file';
            }

            // Function to get file icon color class
            function getFileIconClass(fileName) {
                const ext = fileName.split('.').pop().toLowerCase();

                if (['pdf'].includes(ext)) return 'file-icon-pdf';
                if (['doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) return 'file-icon-doc';
                if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) return 'file-icon-img';
                if (['mp4', 'avi', 'mov', 'wmv', 'mkv', 'webm'].includes(ext)) return 'file-icon-video';
                if (['mp3', 'wav', 'ogg', 'flac', 'm4a'].includes(ext)) return 'file-icon-audio';
                if (['zip', 'rar', '7z', 'tar', 'gz'].includes(ext)) return 'file-icon-zip';
                if (['html', 'css', 'js', 'php', 'py', 'java', 'cpp', 'c', 'json', 'xml'].includes(ext)) return 'file-icon-code';

                return 'file-icon-default';
            }

            // Function to format file size
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';

                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));

                return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
            }

            // Function to format date
            function formatDate(timestamp) {
                const date = new Date(timestamp * 1000);
                const now = new Date();
                const diff = now - date;

                // If less than 24 hours, show relative time
                if (diff < 86400000) {
                    const hours = Math.floor(diff / 3600000);
                    if (hours < 1) {
                        const minutes = Math.floor(diff / 60000);
                        return minutes <= 1 ? 'Just now' : minutes + ' minutes ago';
                    }
                    return hours === 1 ? '1 hour ago' : hours + ' hours ago';
                }

                // Otherwise show date
                const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                return date.toLocaleDateString('en-US', options);
            }

            // Copy link to clipboard
            $fileTableBody.on('click', '.copy-link', function () {
                const url = $(this).data('url');
                const $btn = $(this);
                const originalHtml = $btn.html();

                // Disable button and show loading
                $btn.prop('disabled', true).addClass('opacity-50 cursor-not-allowed');
                $btn.html('<i class="fas fa-spinner fa-spin md:mr-1"></i> <span class="hidden md:inline">Copying...</span>');

                // Copy to clipboard
                navigator.clipboard.writeText(url).then(function () {
                    // Show feedback
                    $btn.html('<i class="fas fa-check md:mr-1"></i> <span class="hidden md:inline">Copied!</span>');
                    $btn.removeClass('bg-green-600 hover:bg-green-700').addClass('bg-gray-600');

                    setTimeout(function () {
                        $btn.html(originalHtml);
                        $btn.removeClass('bg-gray-600 opacity-50 cursor-not-allowed').addClass('bg-green-600 hover:bg-green-700');
                        $btn.prop('disabled', false);
                    }, 2000);
                }).catch(function () {
                    // Show error
                    $btn.html('<i class="fas fa-times md:mr-1"></i> <span class="hidden md:inline">Failed</span>');
                    $btn.removeClass('bg-green-600 hover:bg-green-700').addClass('bg-red-600');

                    setTimeout(function () {
                        $btn.html(originalHtml);
                        $btn.removeClass('bg-red-600 opacity-50 cursor-not-allowed').addClass('bg-green-600 hover:bg-green-700');
                        $btn.prop('disabled', false);
                    }, 2000);
                });
            });

            // Delete single file
            $fileTableBody.on('click', '.delete-file', function () {
                const filename = $(this).data('filename');
                const $row = $(this).closest('tr');
                const $btn = $(this);

                // Show confirmation dialog using SweetAlert2
                Swal.fire({
                    title: 'Delete File?',
                    text: `Are you sure you want to delete "${filename}"? This action cannot be undone!`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#dc2626',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'Cancel',
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Disable button and show loading
                        const originalHtml = $btn.html();
                        $btn.prop('disabled', true).addClass('opacity-50 cursor-not-allowed');
                        $btn.html('<i class="fas fa-spinner fa-spin md:mr-1"></i> <span class="hidden md:inline">Deleting...</span>');

                        // User confirmed, delete the file
                        deleteFile(filename, $row);
                    }
                });
            });

            // Function to delete a single file
            function deleteFile(filename, $row) {
                // AJAX request to delete file
                $.ajax({
                    url: 'delete.php',
                    type: 'POST',
                    data: { filename: filename },
                    dataType: 'json',
                    success: function (response) {
                        if (response.success) {
                            // Show success message
                            Swal.fire({
                                icon: 'success',
                                title: 'Deleted!',
                                text: response.message,
                                timer: 2000,
                                showConfirmButton: false
                            });

                            // Remove row from table with animation
                            $row.fadeOut(300, function () {
                                $(this).remove();

                                // Update file arrays
                                allFiles = allFiles.filter(f => f.name !== filename);
                                filteredFiles = filteredFiles.filter(f => f.name !== filename);

                                // Update counters
                                $totalFiles.text(allFiles.length);
                                $showingFiles.text(filteredFiles.length);

                                // Check if no files left
                                if (allFiles.length === 0) {
                                    $tableContainer.hide();
                                    $emptyState.removeClass('hidden').addClass('flex');
                                    $emptyState.find('h3').text('No Files Found');
                                    $emptyState.find('p').text('Upload some files to get started');
                                }
                            });
                        } else {
                            // Re-enable button
                            const $btn = $row.find('.delete-file');
                            $btn.prop('disabled', false).removeClass('opacity-50 cursor-not-allowed');
                            $btn.html('<i class="fas fa-trash-alt md:mr-1"></i> <span class="hidden md:inline">Delete</span>');

                            // Show error message
                            Swal.fire({
                                icon: 'error',
                                title: 'Error!',
                                text: response.message
                            });
                        }
                    },
                    error: function () {
                        // Re-enable button
                        const $btn = $row.find('.delete-file');
                        $btn.prop('disabled', false).removeClass('opacity-50 cursor-not-allowed');
                        $btn.html('<i class="fas fa-trash-alt md:mr-1"></i> <span class="hidden md:inline">Delete</span>');

                        // Show error message
                        Swal.fire({
                            icon: 'error',
                            title: 'Error!',
                            text: 'Failed to delete file. Please try again.'
                        });
                    }
                });
            }

            // Function to delete all files
            function deleteAllFiles() {
                // AJAX request to delete all files
                $.ajax({
                    url: 'delete.php',
                    type: 'POST',
                    data: { delete_all: true },
                    dataType: 'json',
                    success: function (response) {
                        // Re-enable button
                        $deleteAllBtn.prop('disabled', false).removeClass('opacity-50 cursor-not-allowed');
                        $deleteAllBtn.html('<i class="fas fa-trash-alt md:mr-2"></i> <span class="hidden md:inline">Delete All</span>');

                        if (response.success) {
                            // Show success message
                            Swal.fire({
                                icon: 'success',
                                title: 'Deleted!',
                                text: response.message,
                                timer: 2000,
                                showConfirmButton: false
                            });

                            // Clear all files and reload
                            allFiles = [];
                            filteredFiles = [];
                            $totalFiles.text('0');
                            $showingFiles.text('0');

                            // Show empty state
                            $tableContainer.hide();
                            $emptyState.removeClass('hidden').addClass('flex');
                            $emptyState.find('h3').text('No Files Found');
                            $emptyState.find('p').text('Upload some files to get started');
                        } else {
                            // Show error message
                            Swal.fire({
                                icon: 'error',
                                title: 'Error!',
                                text: response.message
                            });
                        }
                    },
                    error: function () {
                        // Re-enable button
                        $deleteAllBtn.prop('disabled', false).removeClass('opacity-50 cursor-not-allowed');
                        $deleteAllBtn.html('<i class="fas fa-trash-alt md:mr-2"></i> <span class="hidden md:inline">Delete All</span>');

                        // Show error message
                        Swal.fire({
                            icon: 'error',
                            title: 'Error!',
                            text: 'Failed to delete files. Please try again.'
                        });
                    }
                });
            }

            // funciton to redirect to delete mode
            $("#fileIcon").on('dblclick', function () {
                const currentUrl = new URL(window.location.href);
                currentUrl.searchParams.set('delete', 'true');
                window.location.href = currentUrl.toString();
            });

        });
    </script>

</body>

</html>